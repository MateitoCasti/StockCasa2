<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stock Casa - Control Total</title>
  <style>
    /* Colores para el Modo Oscuro */
body.dark-mode {
  background-color: #1a202c;
  color: #f7fafc;
}
.dark-mode .card-input, .dark-mode li {
  background-color: #2d3748;
  color: white;
  border-color: #4a5568;
}
.dark-mode input, .dark-mode select {
  background-color: #4a5568;
  color: white;
  border: 1px solid #718096;
}
    body { font-family: sans-serif; padding: 20px; max-width: 500px; margin: auto; background-color: #f9f9f9; }
    h1 { text-align: center; color: #333; }
    
    .formulario { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    input, select, button { width: 100%; padding: 10px; margin: 5px 0 15px 0; box-sizing: border-box; font-size: 16px; border-radius: 5px; border: 1px solid #ccc; }
    
    button { background-color: #91bd92; color: white; border: none; font-weight: bold; cursor: pointer; }
    button:active { transform: scale(0.98); }
    .btn-voz { background-color: #2196F3; }
    
    ul { list-style: none; padding: 0; max-height: 400px; overflow-y: auto; }
    li { background: white; margin-bottom: 10px; padding: 12px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    
    .controles { display: flex; gap: 5px; }
    .btn-cant { width: 35px; height: 35px; padding: 0; margin: 0; }
    .btn-borrar { background-color: #ff4d4d; width: 35px; height: 35px; padding: 0; margin: 0; }
    .cantidad-badge { background: #eee; padding: 2px 8px; border-radius: 4px; font-weight: bold; }
  </style>
</head>
<body>
<button onclick="toggleModoOscuro()" style="width: 50px; float: right; background: #4a5568; border-radius: 20px;">üåô</button>
  <h1>üì¶ Control de Stock</h1>

  <div class="formulario">
    <label>Producto:</label>
    <input type="text" id="producto" placeholder="Ej: Tomates">
    
    <label>Cantidad:</label>
    <input type="number" id="cantidad" placeholder="Ej: 2">
    
    <label>Categor√≠a:</label>
    <select id="categoria">
      <option value="Verduras">ü•ï Verduras</option>
      <option value="Frutas">üçé Frutas</option>
      <option value="Limpieza">üßΩ Limpieza</option>
      <option value="Almac√©n">üè† Almac√©n</option>
       <option value="Emprendimiento">üè† Filamento</option>
    </select>
<label>Fecha de Vencimiento</label>
<input type="date" id="vencimiento">
    <button onclick="agregarProducto()">A√±adir a la lista</button>
    <button class="btn-voz" onclick="hablar()">üéôÔ∏è Cargar por Voz</button>
    <button onclick="enviarWhatsApp()" style="background-color: #25D366; color: white; margin-top: 10px;">
   üì± Enviar Faltantes por WhatsApp
</button>
  </div>

 <div style="display: flex; gap: 8px; overflow-x: auto; padding: 10px 0; margin-bottom: 10px;">
  <button onclick="filtrarPorCategoria('Todas')" style="width: auto; background: #94a3b8; padding: 8px 15px; font-size: 12px; color: white; border: none; border-radius: 5px;">Ver Todo</button>
  <button onclick="filtrarPorCategoria('Verduras')" style="width: auto; background: #48bb78; padding: 8px 15px; font-size: 12px; color: white; border: none; border-radius: 5px;">Verduras</button>
  <button onclick="filtrarPorCategoria('Frutas')" style="width: auto; background: #ed64a6; padding: 8px 15px; font-size: 12px; color: white; border: none; border-radius: 5px;">Frutas</button>
  <button onclick="filtrarPorCategoria('Limpieza')" style="width: auto; background: #4299e1; padding: 8px 15px; font-size: 12px; color: white; border: none; border-radius: 5px;">Limpieza</button>
  <button onclick="filtrarPorCategoria('Almac√©n')" style="width: auto; background: #f6ad55; padding: 8px 15px; font-size: 12px; color: white; border: none; border-radius: 5px;">Almac√©n</button>
</div>
<button onclick="modoCompras()" style="width: auto; background: #2d3748; color: white; padding: 8px 15px; font-size: 12px; border: 2px solid #ff4d4d; border-radius: 5px;">‚ö†Ô∏è Modo Compras</button>
<h2>Lista de Stock</h2>
<ul id="lista"></ul>

  <script>
    const lista = document.getElementById("lista");

    window.onload = function() {
      const guardado = localStorage.getItem("miStockPersonal");
      if (guardado) { lista.innerHTML = guardado; }
    };

    function guardar() {
      localStorage.setItem("miStockPersonal", lista.innerHTML);
    }

    function agregarProducto() {
      const prod = document.getElementById("producto").value;
      const cant = document.getElementById("cantidad").value;
      const cat = document.getElementById("categoria").value;
      const fechaVenc = document.getElementById("vencimiento").value

      if (prod === "" || cant === "") {
        alert("Escribe el nombre y la cantidad");
        return;
      }

      const item = document.createElement("li");
      item.innerHTML = `
        <div>
          <small>${cat}</small><br>
          <strong>${prod}</strong>: <span class="num">${cant}</span>
        </div>
        <div class="controles">
          <button class="btn-cant" onclick="cambiar(this, 1)">+</button>
          <button class="btn-cant" onclick="cambiar(this, -1)">-</button>
          <button class="btn-borrar" onclick="borrar(this)">‚ùå</button>
        </div>
      `;

      lista.appendChild(item);
      guardar();
      
      document.getElementById("producto").value = "";
      document.getElementById("cantidad").value = "";
      
    }

    function cambiar(btn, valor) {
      const li = btn.closest("li");
      const span = li.querySelector(".num");
      let actual = parseInt(span.innerText);
      let nuevo = actual + valor;
      if (nuevo < 0) nuevo = 0;
      span.innerText = nuevo;
      guardar();
    }

    function borrar(btn) {
      btn.closest("li").remove();
      guardar();
    }

    function hablar() {
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = "es-AR";

  recognition.onresult = function(event) {
    let voz = event.results[0][0].transcript.toLowerCase();
    
    // Diccionario para convertir n√∫meros hablados a n√∫meros reales
    const numerosALetras = {
      "un": 1, "uno": 1, "una": 1, "dos": 2, "tres": 3, "cuatro": 4, 
      "cinco": 5, "seis": 6, "siete": 7, "ocho": 8, "nueve": 9, "diez": 10
    };

    let cantidadDetectada = 1; // Por defecto 1
    let productoDetectado = voz;

    // 1. Intentar encontrar n√∫meros escritos (2, 5, 10...)
    const matches = voz.match(/\d+/);
    if (matches) {
      cantidadDetectada = matches[0];
      productoDetectado = voz.replace(matches[0], "").trim();
    } else {
      // 2. Si no hay n√∫meros, buscar si dijiste "dos", "tres", etc.
      const palabras = voz.split(" ");
      for (let palabra of palabras) {
        if (numerosALetras[palabra]) {
          cantidadDetectada = numerosALetras[palabra];
          productoDetectado = voz.replace(palabra, "").trim();
          break;
        }
      }
    }

    // Limpiar el nombre del producto de palabras sobrantes como "de" (ej: "2 de tomates")
    productoDetectado = productoDetectado.replace(/^(de|un|una|unos|unas)\s+/, "");

    document.getElementById("cantidad").value = cantidadDetectada;
    document.getElementById("producto").value = productoDetectado;
  };

  recognition.start();
}
function filtrarPorCategoria(categoriaSeleccionada) {
  // Buscamos todos los "renglones" (li) de tu lista actual
  const productos = document.querySelectorAll("#lista li");

  productos.forEach(producto => {
    // Buscamos el texto de la categor√≠a que guardamos en el <small>
    const textoCategoria = producto.querySelector("small").innerText.toUpperCase();
    const seleccion = categoriaSeleccionada.toUpperCase();

    // Si tocamos "Todas", mostramos todo. Si no, comparamos.
    if (categoriaSeleccionada === "Todas" || textoCategoria.includes(seleccion)) {
      producto.style.display = "flex"; // Se muestra
    } else {
      producto.style.display = "none"; // Se esconde
    }
  });
} //FUNCION ENVIO WSP
function enviarWhatsApp() {
  const listaProductos = document.getElementById("lista");
  const items = listaProductos.getElementsByTagName("li");
  
  if (items.length === 0) {
    alert("Tu lista est√° vac√≠a, carg√° algo primero.");
    return;
  }

  let mensaje = "üõí *Mi Inventario de Stock:*%0A%0A";

  for (let i = 0; i < items.length; i++) {
    // Buscamos el nombre (que est√° en un strong)
    const nombre = items[i].querySelector("strong").innerText;
    
    // Buscamos la cantidad. Si no encuentra la clase, busca el primer n√∫mero que vea
    let cantidad = "1";
    const badge = items[i].querySelector(".badge-cantidad, .cantidad-badge, .num");
    if (badge) {
      cantidad = badge.innerText;
    }

    mensaje += `‚úÖ *${nombre}*: ${cantidad}%0A`;
  }

  // Esto obliga al navegador a abrir la pesta√±a
  const url = "https://wa.me/?text=" + mensaje;
  window.open(url, '_blank').focus();
}

  // Abre WhatsApp con el mensaje armado
  window.open(`https://wa.me/?text=${mensaje}`, '_blank');
  
  //MODO COMPRA

  function modoCompras() {
  const productos = document.querySelectorAll("#lista li");
  productos.forEach(p => {
    const badge = p.querySelector(".badge-cantidad, .cantidad-badge, .num");
    const cantidad = parseInt(badge.innerText);
    
    // Si tienes 1 o menos, es un faltante
    if (cantidad <= 1) {
      p.style.display = "flex";
      p.style.borderLeft = "6px solid #ff4d4d"; // Resaltamos con rojo
    } else {
      p.style.display = "none"; // Ocultamos lo que ya tenemos
    }
  });
}

function toggleModoOscuro() {
  document.body.classList.toggle("dark-mode");
}
  </script>
</body>
</html>
