<!DOCTYPE html>
<html lang="es">
<head>
  <link rel="manifest" href="manifest.json">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stock Casa - Control Total</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; padding: 20px; max-width: 500px; margin: auto; background-color: #f0f2f5; transition: 0.3s; color: #333; }
    h1 { text-align: center; margin-bottom: 20px; font-size: 24px; }
    
    .formulario { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 8px; }
    label { font-weight: 600; font-size: 13px; color: #666; margin-top: 8px; }
    input, select, button { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #e0e0e0; font-size: 16px; box-sizing: border-box; }
    
    .btn-principal { background: #91bd92; color: white; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; }
    .btn-voz { background: #2196F3; color: white; border: none; font-weight: bold; }
    .btn-wsp { background: #25D366; color: white; border: none; font-weight: bold; }

    .seccion-nueva-cat { display: flex; gap: 8px; margin-top: 5px; }
    .btn-add-cat { width: auto; background: #4a5568; color: white; padding: 0 20px; border: none; }

    /* Contenedor de Filtros Corregido */
    /* Barra de Filtros con Scroll Visible en PC */
    #contenedorFiltros { 
      display: flex; 
      gap: 10px; 
      overflow-x: auto; 
      padding: 15px 5px; 
      cursor: grab; /* Cambia el cursor a una mano para indicar que se puede mover */
      scrollbar-width: thin; /* Barra fina en Firefox */
      scrollbar-color: #91bd92 #f0f2f5; 
    }

    /* Estilo de la barra de scroll para Chrome/Edge */
    #contenedorFiltros::-webkit-scrollbar {
      height: 6px;
    }
    #contenedorFiltros::-webkit-scrollbar-thumb {
      background: #cbd5e0;
      border-radius: 10px;
    }
    
    .btn-filtro { flex: 0 0 auto; width: auto; background: #fff; color: #4a5568; border: 1px solid #e0e0e0; padding: 8px 16px; font-size: 13px; font-weight: 600; border-radius: 10px; cursor: pointer; }

    ul { list-style: none; padding: 0; margin-top: 10px; }
    li { background: white; margin-bottom: 12px; padding: 15px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border-left: 6px solid #91bd92; }
    .num { font-size: 20px; font-weight: 800; color: #2d3748; margin-right: 10px; }
    .controles { display: flex; gap: 6px; }
    .btn-cant { width: 38px; height: 38px; padding: 0; background: #f8f9fa; border: 1px solid #eee; color: #333; }
    .btn-borrar { background: #fff5f5; color: #ff4d4d; border: 1px solid #ffe3e3; width: 38px; }

    /* Modal de Bienvenida - FIX */
    #modalBienvenida { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: flex; justify-content: center; align-items: center; z-index: 10000; visibility: visible; opacity: 1; transition: 0.3s; }
    .modal-contenido { background: white; padding: 30px; border-radius: 25px; max-width: 80%; text-align: center; color: #333; }

    body.dark-mode { background: #1a202c; color: white; }
    .dark-mode .formulario, .dark-mode li, .dark-mode .btn-filtro { background: #2d3748; color: white; border-color: #4a5568; }
    .dark-mode input, .dark-mode select { background: #4a5568; color: white; border-color: #4a5568; }
  </style>
</head>
<body>

  <div id="modalBienvenida">
    <div class="modal-contenido">
      <h2 style="margin-top:0">¬°Bienvenido! üì¶</h2>
      <p>Organiza tu hogar de forma privada.</p>
      <button onclick="cerrarBienvenida()" style="background: #48bb78; color: white; border: none; padding: 15px; font-weight: bold; cursor:pointer; border-radius: 12px;">¬°Entendido!</button>
    </div>
  </div>

  <button onclick="toggleModoOscuro()" style="width: 50px; float: right; background: #4a5568; border-radius: 50%; color: white; border: none; cursor: pointer; padding: 10px; height: 50px; margin-bottom: 10px;">üåô</button>
  
  <div style="clear: both;"></div>
  <h1>üì¶ Control de Stock</h1>

  <div class="formulario">
    <label>Producto</label>
    <input type="text" id="producto" placeholder="Ej: Leche">
    
    <label>Cantidad</label>
    <input type="number" id="cantidad" placeholder="Cantidad">
    
    <label>Categor√≠a</label>
    <select id="categoria"></select>

    <div class="seccion-nueva-cat">
      <input type="text" id="nuevaCategoria" placeholder="Nueva..." style="margin:0">
      <button class="btn-add-cat" onclick="agregarNuevaCategoria()">‚ûï</button>
    </div>
    
    <button onclick="restablecerCategorias()" style="background: none; color: #ed8936; font-size: 11px; border: none; cursor: pointer; text-decoration: underline;">Restablecer originales</button>

    <label>Vencimiento</label>
    <input type="date" id="vencimiento">

    <button class="btn-principal" onclick="agregarProducto()">A√±adir a la lista</button>
    <button class="btn-voz" onclick="hablar()">üéôÔ∏è Cargar por Voz</button>
    <button class="btn-wsp" onclick="enviarWhatsApp()">üì± Enviar por WhatsApp</button>
  </div>

  <div id="contenedorFiltros"></div>

  <h2 style="font-size: 18px; margin-left: 5px;">Lista de Productos</h2>
  <ul id="lista"></ul>

  <script>
    const lista = document.getElementById("lista");

    document.addEventListener("DOMContentLoaded", () => {
      const guardado = localStorage.getItem("miStockPersonal");
      if (guardado) lista.innerHTML = guardado;
      
      cargarCategorias();

      // Fix Bienvenida: Forzamos el cierre si ya se vio
      if (localStorage.getItem("bienvenidaVista") === "true") {
        document.getElementById("modalBienvenida").style.display = "none";
      }
    });

    function cerrarBienvenida() {
      document.getElementById("modalBienvenida").style.display = "none";
      localStorage.setItem("bienvenidaVista", "true");
    }

    function guardar() { localStorage.setItem("miStockPersonal", lista.innerHTML); }

    function cargarCategorias() {
      const selector = document.getElementById("categoria");
      const cats = JSON.parse(localStorage.getItem("misCategorias")) || ["ü•ï Verduras", "üçé Frutas", "üßΩ Limpieza", "üè† Almac√©n"];
      selector.innerHTML = "";
      cats.forEach(c => {
        let opt = document.createElement("option");
        opt.value = c; opt.textContent = c;
        selector.appendChild(opt);
      });
      actualizarBotonesFiltro(cats);
    }

    function actualizarBotonesFiltro(cats) {
      const cont = document.getElementById("contenedorFiltros");
      cont.innerHTML = "";
      
      const btnT = document.createElement("button");
      btnT.className = "btn-filtro"; btnT.innerText = "Ver Todo";
      btnT.onclick = () => filtrarPorCategoria('Todas');
      cont.appendChild(btnT);

      cats.forEach(c => {
        const b = document.createElement("button");
        b.className = "btn-filtro"; b.innerText = c;
        b.onclick = () => filtrarPorCategoria(c);
        cont.appendChild(b);
      });

      const btnC = document.createElement("button");
      btnC.className = "btn-filtro"; btnC.innerText = "‚ö†Ô∏è Compras";
      btnC.style.borderColor = "#ff4d4d"; btnC.style.color = "#ff4d4d";
      btnC.onclick = () => modoCompras();
      cont.appendChild(btnC);
    }

    function filtrarPorCategoria(cat) {
      document.querySelectorAll("#lista li").forEach(li => {
        const txt = li.querySelector("small").innerText;
        li.style.display = (cat === "Todas" || txt.includes(cat)) ? "flex" : "none";
      });
    }

    function modoCompras() {
      document.querySelectorAll("#lista li").forEach(li => {
        const n = parseInt(li.querySelector(".num").innerText);
        li.style.display = (n <= 1) ? "flex" : "none";
      });
    }

    function agregarNuevaCategoria() {
      const val = document.getElementById("nuevaCategoria").value.trim();
      if (!val) return;
      let cats = JSON.parse(localStorage.getItem("misCategorias")) || ["ü•ï Verduas", "üçé Frutas", "üßΩ Limpieza", "üè† Almac√©n"];
      if (!cats.includes(val)) {
        cats.push(val);
        localStorage.setItem("misCategorias", JSON.stringify(cats));
        cargarCategorias();
        document.getElementById("nuevaCategoria").value = "";
      }
    }

    function agregarProducto() {
      const p = document.getElementById("producto").value;
      const c = document.getElementById("cantidad").value;
      const cat = document.getElementById("categoria").value;
      const f = document.getElementById("vencimiento").value;
      if (!p || !c) return alert("Faltan datos");

      const li = document.createElement("li");
      li.innerHTML = `<div><small>${cat}</small><br><strong>${p}</strong>${f ? `<br><small>üìÖ ${f}</small>` : ''}</div>
      <div style="display:flex; align-items:center"><span class="num">${c}</span>
      <div class="controles"><button class="btn-cant" onclick="cambiar(this,1)">+</button><button class="btn-cant" onclick="cambiar(this,-1)">-</button><button class="btn-borrar" onclick="borrar(this)">‚ùå</button></div></div>`;
      lista.appendChild(li);
      guardar();
      document.getElementById("producto").value = "";
      document.getElementById("cantidad").value = "";
    }

    function cambiar(b, v) {
      const s = b.closest("li").querySelector(".num");
      s.innerText = Math.max(0, parseInt(s.innerText) + v);
      guardar();
    }

    function borrar(b) { if(confirm("¬øEliminar?")) { b.closest("li").remove(); guardar(); } }

    function toggleModoOscuro() { document.body.classList.toggle("dark-mode"); }

    function enviarWhatsApp() {
      let m = "üõí *Faltantes:*%0A";
      document.querySelectorAll("#lista li").forEach(li => {
        if (li.style.display !== "none") m += `‚Ä¢ ${li.querySelector("strong").innerText}: ${li.querySelector(".num").innerText}%0A`;
      });
      window.open("https://wa.me/?text=" + m, '_blank');
    }

    function restablecerCategorias() {
      if (confirm("¬øBorrar categor√≠as?")) {
        localStorage.removeItem("misCategorias");
        cargarCategorias();
      }
    }

    function hablar() {
      const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!Speech) return alert("Voz no soportada en este navegador");
      const r = new Speech();
      r.lang = "es-AR";
      r.onresult = (e) => { document.getElementById("producto").value = e.results[0][0].transcript.toLowerCase(); };
      r.start();
    }

    // Permite mover la barra de categor√≠as con la rueda del mouse en PC
const scrollContenedor = document.getElementById("contenedorFiltros");

scrollContenedor.addEventListener("wheel", (evt) => {
    evt.preventDefault();
    scrollContenedor.scrollLeft += evt.deltaY;
});

// Opcional: Permitir arrastrar con el click del mouse (estilo celular en PC)
let isDown = false;
let startX;
let scrollLeft;

scrollContenedor.addEventListener('mousedown', (e) => {
  isDown = true;
  scrollContenedor.style.cursor = 'grabbing';
  startX = e.pageX - scrollContenedor.offsetLeft;
  scrollLeft = scrollContenedor.scrollLeft;
});
scrollContenedor.addEventListener('mouseleave', () => {
  isDown = false;
  scrollContenedor.style.cursor = 'grab';
});
scrollContenedor.addEventListener('mouseup', () => {
  isDown = false;
  scrollContenedor.style.cursor = 'grab';
});
scrollContenedor.addEventListener('mousemove', (e) => {
  if(!isDown) return;
  e.preventDefault();
  const x = e.pageX - scrollContenedor.offsetLeft;
  const walk = (x - startX) * 2; // Velocidad de movimiento
  scrollContenedor.scrollLeft = scrollLeft - walk;
});
  </script>
</body>
</html>
